**NMAP - Advanced Port & Service Scanning**
Purpose: Detailed service enumeration, version detection, OS fingerprinting, vulnerability scripts.

**When to Use Nmap vs Naabu**

| **IF:** Initial port discovery in pipeline<br><br>**THEN:** Use NAABU - faster, better pipeline integration      |
| :--------------------------------------------------------------------------------------------------------------- |
| **IF:** Need service versions, OS detection, or NSE scripts<br><br>**THEN:** Use NMAP - more detailed but slower |
| **IF:** Best practice<br><br>**THEN:** Use NAABU first for discovery, then NMAP on open ports                    |

**Scan Type Decision Tree**

| **Condition**     | **Action / Command**                |
| :---------------- | :---------------------------------- |
| Quick TCP scan    | nmap -T4 -F $TARGET                 |
| Full TCP scan     | nmap -p- -T4 $TARGET                |
| Service detection | nmap -sV $TARGET                    |
| OS detection      | nmap -O $TARGET                     |
| Aggressive scan   | nmap -A $TARGET                     |
| UDP scan          | sudo nmap -sU -p 53,161,500 $TARGET |
| Stealth SYN       | sudo nmap -sS -T2 $TARGET           |
| Version + scripts | nmap -sV -sC $TARGET                |

**Timing Template Selection**

| **Condition**      | **Action / Command**             |
| :----------------- | :------------------------------- |
| IDS evasion needed | -T0 or -T1 (very slow, stealthy) |
| Normal scan        | -T3 (default)                    |
| Fast scan          | -T4 (aggressive timing)          |
| Very fast (local)  | -T5 (insane, may miss ports)     |

**Firewall Evasion Techniques**

| **Condition**      | **Action / Command**           |
| :----------------- | :----------------------------- |
| Fragment packets   | nmap -f $TARGET                |
| Decoy scan         | nmap -D RND:10 $TARGET         |
| Custom source port | nmap --source-port 53 $TARGET  |
| Randomize hosts    | nmap --randomize-hosts $TARGET |
| Append random data | nmap --data-length 25 $TARGET  |

**NSE Script Categories**

| **Condition**      | **Action / Command**                      |
| :----------------- | :---------------------------------------- |
| Default scripts    | nmap -sC $TARGET                          |
| Vulnerability scan | nmap --script vuln $TARGET                |
| Discovery          | nmap --script discovery $TARGET           |
| Specific CVE       | nmap --script http-vuln-cve2021-* $TARGET |
| Safe scripts only  | nmap --script 'safe' $TARGET              |

**Output Decisions**

| **Condition**     | **Action / Command**          |
| :---------------- | :---------------------------- |
| All formats       | nmap -oA scan_results $TARGET |
| XML (for parsing) | nmap -oX scan.xml $TARGET     |
| Grepable          | nmap -oG scan.gnmap $TARGET   |
| Normal text       | nmap -oN scan.txt $TARGET     |
